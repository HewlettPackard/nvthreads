target = "nvm"

task :default => ["#{target}.pdf"]

def compile(target)
  sh "pdflatex #{target}.tex"
  if %x[grep 'citation{' #{target}.aux] != "" and %x[grep 'bibdata{' #{target}.aux] != ""
    sh "bibtex #{target}"
    sh "pdflatex #{target}.tex"
  end
  sh "pdflatex #{target}.tex"
end

file "#{target}.pdf" => ["#{target}.tex"] do
  compile(target)
end

task :force do
  compile(target)
end

task :clean do
  ["pdf", "aux", "log", "bbl", "blg"].each do |suf|
    sh "\\rm #{target}.#{suf}"
  end
end
